# AudioAndCamera 프로젝트 설명서

## 프로젝트 개요

**AudioAndCamera**는 PySerial과 카메라를 이용한 동시 녹화 및 분석 시스템입니다. 실제 하드웨어가 없어도 가상 장치(Fake Device)를 통해 테스트할 수 있는 기능을 제공하며, 실시간 오디오/비디오 녹화, 히트맵 오버레이 분석, 오디오 스펙트럼 분석 등의 기능을 포함합니다.

## 프로젝트 구조

```
AudioAndCamera/
├── main.py                 # 메인 애플리케이션 파일
├── pyproject.toml          # 프로젝트 설정 및 의존성
├── work_log.txt           # 개발 작업 일지
├── project_info.md        # 프로젝트 정보
├── README.md              # 프로젝트 설명
├── .gitignore             # Git 무시 파일
├── .python-version        # Python 버전 지정
├── uv.lock                # 의존성 잠금 파일
└── .vercel/               # Vercel 배포 설정
    └── project.json
```

## 핵심 기술 스택

### 프레임워크 및 라이브러리
- **PyQt5 (5.15.10)**: GUI 프레임워크
- **OpenCV (>=4.8.0)**: 컴퓨터 비전 및 비디오 처리
- **PySerial (>=3.5)**: 시리얼 통신
- **NumPy (>=1.24.0)**: 수치 계산
- **SciPy (>=1.10.0)**: 과학 계산 (FFT, STFT)
- **PyQtGraph (>=0.13.0)**: 실시간 그래프 및 인터랙티브 위젯
- **Matplotlib (>=3.7.0)**: 정적 그래프 및 컬러맵

### 개발 환경
- **Python**: >=3.12
- **패키지 관리**: uv
- **운영체제**: Windows 지원

## 주요 클래스 구조

### 1. 가상 장치 클래스

#### `FakeSerialDevice` (라인 27)
- **목적**: 실제 시리얼 장치가 없을 때 가상 오디오 데이터 생성
- **기능**:
  - 32채널 오디오 데이터 시뮬레이션 (51.2kHz 샘플레이트)
  - 1926바이트 단위 데이터 패킷 생성
  - 정현파 기반 테스트 신호 생성

#### `FakeCameraDevice` (라인 60)
- **목적**: 실제 카메라가 없을 때 가상 비디오 스트림 생성
- **기능**:
  - 움직이는 테스트 패턴 생성 (640x480 해상도)
  - NumPy 벡터화 연산을 통한 성능 최적화
  - 실시간 패턴 변화 (시간 기반 애니메이션)

### 2. 장치 관리 클래스

#### `SerialManager` (라인 112)
- **목적**: 시리얼 장치 자동 감지 및 관리
- **기능**:
  - 사용 가능한 시리얼 포트 자동 스캔
  - 실제 장치 연결 실패 시 Fake 모드로 자동 전환
  - 데이터 수신 확인 로직 (1.5초 테스트)

#### `CameraManager` (라인 175)
- **목적**: 카메라 장치 자동 감지 및 관리
- **기능**:
  - OpenCV를 통한 카메라 장치 감지
  - 실제 카메라 연결 실패 시 Fake 모드로 자동 전환
  - 30fps 비디오 캡처 설정

### 3. 녹화 시스템

#### `RecordingThread` (라인 220)
- **목적**: 멀티스레드 기반 오디오/비디오 동시 녹화
- **기능**:
  - 실시간 오디오/비디오 데이터 수집
  - WAV 파일 (32채널, 51.2kHz) 및 MP4 파일 저장
  - Fake 모드에서 정확히 10초 분량 데이터 생성
  - 진행률 및 상태 업데이트 신호 발송

### 4. GUI 탭 클래스

#### `RecordTab` (라인 363)
- **목적**: 녹화 기능 및 실시간 카메라 피드 표시
- **기능**:
  - 실시간 카메라 화면 표시 (16fps 업데이트)
  - 녹화 시작/정지 컨트롤
  - 진행률 표시 (초 단위)
  - 장치 상태 모니터링

#### `AnalysisTab` (라인 528)
- **목적**: 비디오 파일 분석 및 히트맵 오버레이
- **기능**:
  - 비디오 파일 로드 및 재생
  - 실시간 히트맵 오버레이 (10초 길이 랜덤 2D 데이터)
  - 알파 블렌딩을 통한 투명도 조절
  - 히트맵 전용/비디오 전용/오버레이 모드 선택
  - **인터랙티브 컬러바 시스템**:
    - PyQtGraph HistogramLUTWidget 기반
    - 11가지 컬러맵 선택 (viridis, plasma, inferno, magma, hot, cool, spring, summer, autumn, winter, jet)
    - 사용자 조절 가능한 레벨 범위 (드래그로 min/max 조절)
    - 프레임 변경 시에도 사용자 설정 레벨 유지
    - 컬러바 레벨이 실제 비디오 오버레이에 반영

#### `AudioTab` (라인 868)
- **목적**: 오디오 파일 분석 및 스펙트럼 표시
- **기능**:
  - WAV 파일 로드 및 채널 선택
  - Waveform, FFT, STFT 분석
  - 실시간 그래프 업데이트
  - 멀티채널 오디오 지원

#### `MainWindow` (라인 1007)
- **목적**: 메인 윈도우 및 탭 구조 관리
- **기능**:
  - 3개 탭 (Record, Analysis, Audio) 통합 관리
  - 전체 애플리케이션 라이프사이클 관리

## 주요 구현 기능

### 1. 자동 장치 감지 시스템
- 실제 하드웨어 연결 상태 자동 감지
- 장치 없을 시 Fake 모드로 자동 전환
- 사용자에게 현재 모드 상태 표시

### 2. 실시간 녹화 시스템
- **오디오**: 32채널, 51.2kHz, WAV 형식
- **비디오**: 30fps, MP4 형식
- 멀티스레드 처리로 실시간 성능 보장
- Fake 모드에서 정확한 10초 분량 데이터 생성

### 3. 고급 히트맵 오버레이 시스템
- 비디오와 히트맵 데이터의 실시간 동기화
- 사용자 조절 가능한 투명도 (알파 블렌딩)
- **혁신적인 컬러바 제어**:
  - 실시간 레벨 조정 (드래그 인터페이스)
  - 11가지 과학적 컬러맵 지원
  - 사용자 설정 레벨 고정 기능
  - 컬러바와 실제 이미지 완벽 동기화

### 4. 포괄적인 오디오 분석
- 시간 도메인 분석 (Waveform)
- 주파수 도메인 분석 (FFT)
- 시간-주파수 분석 (STFT)
- 멀티채널 개별 분석 지원

### 5. 성능 최적화
- NumPy 벡터화 연산 활용
- 효율적인 메모리 관리
- 프레임 처리 파이프라인 최적화
- 불필요한 연산 제거

## 파일 간 연결 관계

### 데이터 흐름
```
[시리얼 장치/Fake] → [SerialManager] → [RecordingThread] → [WAV 파일]
[카메라/Fake] → [CameraManager] → [RecordingThread] → [MP4 파일]
[저장된 파일] → [AnalysisTab/AudioTab] → [분석 결과 표시]
```

### 클래스 의존성
```
MainWindow
├── RecordTab
│   ├── SerialManager
│   │   └── FakeSerialDevice
│   ├── CameraManager
│   │   └── FakeCameraDevice
│   └── RecordingThread
├── AnalysisTab
│   └── PyQtGraph HistogramLUTWidget
└── AudioTab
```

### 신호-슬롯 연결
- `RecordingThread` → `RecordTab`: 진행률 및 상태 업데이트
- `AnalysisTab` → 컬러바: 레벨 변경 이벤트
- `AudioTab` → 그래프: 실시간 데이터 업데이트

## 혁신적인 기능 하이라이트

### 1. 지능형 장치 관리
- 하드웨어 의존성 없는 완전한 테스트 환경
- 실제 장치와 가상 장치 간 seamless 전환

### 2. 고급 컬러바 시스템
- 과학적 시각화를 위한 전문적인 컬러맵 지원
- 사용자 친화적인 실시간 레벨 조정
- 프레임 간 일관된 시각화 유지

### 3. 멀티모달 분석
- 오디오와 비디오 데이터의 통합 분석
- 시간 동기화된 멀티채널 처리
- 다양한 분석 도메인 지원

## 확장 가능성

### 단기 확장
- 추가 컬러맵 지원
- 더 많은 오디오 분석 알고리즘
- 실시간 필터링 기능

### 장기 확장
- 머신러닝 기반 패턴 인식
- 클라우드 기반 데이터 처리
- 다중 장치 동시 제어

## 기술적 특징

### 안정성
- 예외 처리 및 오류 복구 메커니즘
- 메모리 누수 방지
- 스레드 안전성 보장

### 확장성
- 모듈화된 클래스 구조
- 플러그인 아키텍처 지원 가능
- 설정 기반 동작 제어

### 사용성
- 직관적인 GUI 인터페이스
- 실시간 피드백
- 상세한 상태 정보 제공

---

**개발 완료일**: 2024년 12월 19일  
**버전**: 0.1.0  
**라이센스**: PyQt5 기반 (상업적 사용 시 라이센스 확인 필요)