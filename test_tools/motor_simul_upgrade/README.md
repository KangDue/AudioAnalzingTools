# BLDC Motor D-Q Control Simulation

BLDC 모터의 d-q 제어 시뮬레이션 프로그램입니다. Python과 CustomTkinter를 기반으로 한 GUI 애플리케이션으로, 모터의 전기적/기계적 특성을 실시간으로 시뮬레이션하고 시각화합니다.

## 주요 기능

### 1. D-Q 제어 시뮬레이션
- **D축 신호 자유 설정**: Sin, Cos, 또는 커스텀 수식 지원
- **실시간 전류 제어**: Id, Iq 전류의 실시간 계산 및 표시
- **PWM 주파수 기반**: 30kHz 기본값, 사용자 설정 가능

### 2. 모터 파라미터 설정
- **극수(Poles) 설정**: 모터 극수 자유 변경
- **전류각 변화량**: 1 tick당 전류각 변화량 설정
- **PWM 주파수**: 시뮬레이션 해상도 조절

### 3. 시각화 기능
- **Radial Flux**: 스테이터에서 생성되는 방사형 자속 시각화
- **RPM 출력**: 실시간 회전수 계산 및 표시
- **모터 형태**: 스테이터와 로터의 기하학적 형태 표시
- **로터 극 관점**: 특정 로터 극에서 느껴지는 자속 변화

### 4. 실시간 모니터링
- **전류 상태**: Id, Iq 전류값 실시간 표시
- **회전 상태**: RPM 실시간 모니터링
- **시뮬레이션 상태**: 진행 상황 및 오류 표시

## 설치 및 실행

### 1. 의존성 설치
```bash
pip install -r requirements.txt
```

### 2. 프로그램 실행
```bash
python main.py
```

## 사용법

### 1. 모터 파라미터 설정
- **Poles**: 모터의 극수 설정 (기본값: 4)
- **PWM Freq**: PWM 주파수 설정 (기본값: 30000 Hz)
- **Current Angle Δ**: 1 tick당 전류각 변화량 (기본값: 0.1 rad)

### 2. D축 신호 설정
- **Sine**: `Amplitude * sin(2π * Frequency * t)`
- **Cosine**: `Amplitude * cos(2π * Frequency * t)`
- **Custom**: 사용자 정의 수식 (예: `np.sin(2*np.pi*t) + 0.5*np.cos(4*np.pi*t)`)

### 3. 시뮬레이션 제어
- **Duration**: 시뮬레이션 실행 시간 설정
- **Start**: 시뮬레이션 시작
- **Stop**: 시뮬레이션 중지
- **Reset**: 모든 상태 초기화

## 시뮬레이션 결과

### 1. D-Q Currents
- D축 및 Q축 전류의 시간에 따른 변화
- 설정된 신호에 따른 전류 제어 결과

### 2. Radial Flux
- 스테이터에서 생성되는 방사형 자속의 크기
- 회전 좌표계에서 고정 좌표계로의 변환 결과

### 3. RPM
- 모터의 회전수 변화
- 토크와 기계적 동역학에 따른 결과

### 4. Motor Geometry
- 스테이터와 로터의 기하학적 형태
- 로터 극의 실시간 위치 표시

### 5. Rotor Pole Flux
- 특정 로터 극에서 느껴지는 자속 변화
- 스테이터 자기장과 로터 극의 상대적 위치 영향

### 6. D-axis Signal
- 설정된 D축 신호의 파형
- 실제 적용되는 신호 확인

## 기술적 세부사항

### 모터 모델
- **인덕턴스**: Ld = Lq = 1mH
- **저항**: Rs = 0.1Ω
- **자속쇄교**: 0.1Wb
- **관성모멘트**: J = 0.001 kg⋅m²
- **점성마찰**: B = 0.0001

### 제어 알고리즘
- **Clarke 변환**: 3상 → α-β 좌표계
- **Park 변환**: α-β → d-q 좌표계
- **PI 제어**: 전류 제어 루프
- **토크 계산**: T = (3/2) × (P/2) × (ψ × Iq + (Ld-Lq) × Id × Iq)

### 수치 해석
- **적분 방법**: 오일러 방법
- **시간 스텝**: 1/PWM_frequency
- **안정성**: 작은 시간 스텝으로 수치적 안정성 확보

## 파일 구조

```
motor_simul_upgrade/
├── main.py                 # 메인 실행 파일
├── main_gui.py             # GUI 인터페이스
├── motor_simulation.py     # 모터 시뮬레이션 엔진
├── requirements.txt        # 의존성 패키지
├── work_log.txt           # 작업 일지
└── README.md              # 프로젝트 설명서
```

## 커스텀 수식 예제

### 기본 신호
```python
# 사인파
np.sin(2*np.pi*10*t)

# 코사인파
np.cos(2*np.pi*5*t)

# 복합 신호
np.sin(2*np.pi*t) + 0.5*np.cos(4*np.pi*t)
```

### 고급 신호
```python
# 지수 감쇠 사인파
np.exp(-t) * np.sin(2*np.pi*10*t)

# 주파수 변조
np.sin(2*np.pi*10*t + 5*np.sin(2*np.pi*t))

# 스텝 함수
1.0 if t > 0.5 else 0.0
```

## 주의사항

1. **커스텀 수식**: 안전한 함수만 사용 가능 (np.sin, np.cos, np.exp 등)
2. **시뮬레이션 시간**: 긴 시뮬레이션은 메모리 사용량 증가
3. **PWM 주파수**: 너무 높은 주파수는 계산 시간 증가
4. **수치 안정성**: 극단적인 파라미터 값은 불안정할 수 있음

## 문제 해결

### 일반적인 오류
1. **Import Error**: `pip install -r requirements.txt` 실행
2. **GUI 오류**: CustomTkinter 버전 확인
3. **수식 오류**: 커스텀 수식 문법 확인
4. **메모리 부족**: 시뮬레이션 시간 단축

### 성능 최적화
1. **시뮬레이션 시간**: 1초 이하 권장
2. **PWM 주파수**: 30kHz 이하 권장
3. **데이터 저장**: 필요시 결과 데이터 저장 기능 추가

## 향후 개발 계획

1. **센서리스 제어**: 위치 센서 없는 제어 알고리즘
2. **고조파 분석**: FFT 기반 주파수 분석
3. **열 모델**: 모터 온도 시뮬레이션
4. **효율 분석**: 전력 효율 계산 및 최적화
5. **3D 시각화**: 3차원 자기장 시각화